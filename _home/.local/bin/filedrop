#!/bin/bash
#
# shellcheck disable=SC2029

set -e

readonly hostname=suki

randdir=
while [[ $randdir == '' || $randdir == */* || $randdir == *-* ]]; do
    randdir="$(openssl rand -base64 10 | head -c 14 | sed -e 's/+/-/' -e 's/\//_/')"
done
ssh "$hostname" "mkdir \"filedrop/$randdir\""
for file in "$@"; do
    stubname="$(echo "${file// /_}" | tr -cd '[:alnum:]\\/._-')"
    scp "$file" "$hostname:filedrop/$randdir/$stubname"
    ssh "$hostname" "chmod a+r \"filedrop/$randdir/$stubname\""
    echo >&2 "https://as8.nl/filedrop/$randdir/$(basename "$stubname")"
done